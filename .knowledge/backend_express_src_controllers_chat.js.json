{"is_source_file": true, "format": "JavaScript", "description": "This file defines the ChatController class for handling chat-related operations in a chess game platform, including listing and sending chat messages within a game. It interfaces with a database and WebSocket hub for real-time updates.", "external_files": ["../db/pool", "../ws/hub"], "external_methods": ["query", "broadcastToGame"], "published": ["new ChatController()"], "classes": [{"name": "ChatController", "description": "Controller class managing chat functionalities such as listing and sending messages within a game."}], "methods": [{"name": "list(req, res, next)", "description": "Fetches and returns chat messages for a specific game, validating user participation.", "scope": "ChatController", "scopeKind": "class"}, {"name": "send(req, res, next)", "description": "Sends a chat message in a game, inserting it into the database and broadcasting it to other clients.", "scope": "ChatController", "scopeKind": "class"}], "calls": ["query('SELECT white_user_id, black_user_id FROM games WHERE id = $1', [gameId])", "query('SELECT id, game_id, sender_user_id, message_text, created_at FROM chat_messages WHERE game_id = $1 ORDER BY created_at ASC LIMIT 200', [gameId])", "query('SELECT white_user_id, black_user_id FROM games WHERE id = $1', [gameId])", "query('INSERT INTO chat_messages (game_id, sender_user_id, message_text, created_at) VALUES ($1, $2, $3, now()) RETURNING id, game_id, sender_user_id, message_text, created_at', [gameId, userId, messageText])", "broadcastToGame(gameId, { type: 'chat', gameId, message: { id, senderUserId, messageText, createdAt } })"], "search-terms": ["ChatController", "send", "list", "chat_messages", "broadcastToGame", "gameId", "WebSocket", "database", "chat"], "state": 2, "file_id": 25, "knowledge_revision": 57, "git_revision": "", "ctags": [{"_type": "tag", "name": "ChatController", "path": "/home/kavia/workspace/code-generation/chess-mastery-platform-309890-309901/backend_express/src/controllers/chat.js", "pattern": "/^class ChatController {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "exports", "path": "/home/kavia/workspace/code-generation/chess-mastery-platform-309890-309901/backend_express/src/controllers/chat.js", "pattern": "/^module.exports = new ChatController();$/", "language": "JavaScript", "kind": "variable", "scope": "module", "scopeKind": "class"}, {"_type": "tag", "name": "list", "path": "/home/kavia/workspace/code-generation/chess-mastery-platform-309890-309901/backend_express/src/controllers/chat.js", "pattern": "/^  async list(req, res, next) {$/", "language": "JavaScript", "kind": "method", "signature": "(req, res, next)", "scope": "ChatController", "scopeKind": "class"}, {"_type": "tag", "name": "send", "path": "/home/kavia/workspace/code-generation/chess-mastery-platform-309890-309901/backend_express/src/controllers/chat.js", "pattern": "/^  async send(req, res, next) {$/", "language": "JavaScript", "kind": "method", "signature": "(req, res, next)", "scope": "ChatController", "scopeKind": "class"}], "hash": "b1ef8145acafb7a41c184883303adfdb", "format-version": 4, "code-base-name": "backend_express", "filename": "backend_express/src/controllers/chat.js", "fields": [{"name": "module.exports = new ChatController();", "scope": "module", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"57": ""}]}